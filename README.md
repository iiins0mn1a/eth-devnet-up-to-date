# ä»¥å¤ªåŠPoSæµ‹è¯•ç½‘ - NS-3ç½‘ç»œé›†æˆç‰ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºNS-3ç½‘ç»œæ¨¡æ‹Ÿå™¨çš„ä»¥å¤ªåŠPoSæµ‹è¯•ç½‘ï¼Œæ”¯æŒåœ¨æ¨¡æ‹Ÿç½‘ç»œç¯å¢ƒä¸­è¿è¡ŒçœŸå®çš„ä»¥å¤ªåŠèŠ‚ç‚¹ï¼Œç”¨äºç ”ç©¶å’Œæµ‹è¯•ç½‘ç»œåè®®ã€å»¶è¿Ÿå½±å“ç­‰åœºæ™¯ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ç½‘ç»œæ‹“æ‰‘
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Beacon-1      â”‚    â”‚   Beacon-2      â”‚    â”‚   Beacon-3      â”‚
â”‚   (Bootstrap)   â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚   10.0.0.1      â”‚    â”‚   10.0.0.2      â”‚    â”‚   10.0.0.3      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Beacon-4      â”‚
                    â”‚                 â”‚
                    â”‚   10.0.0.4      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   NS-3 Network  â”‚
                    â”‚   (CSMA LAN)    â”‚
                    â”‚   Delay: 1ms    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶è¯´æ˜
- **æ‰§è¡Œå±‚**: Go-Ethereum (geth) - å¤„ç†äº¤æ˜“å’ŒçŠ¶æ€
- **å…±è¯†å±‚**: Prysm Beacon Chain - å¤„ç†åŒºå—å…±è¯†
- **éªŒè¯è€…**: Prysm Validator - å‚ä¸å…±è¯†éªŒè¯
- **ç½‘ç»œæ¨¡æ‹Ÿ**: NS-3 - æä¾›å¯æ§çš„ç½‘ç»œç¯å¢ƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚
- Docker & Docker Compose
- NS-3.45 å®‰è£…åœ¨ `/home/ins0/Learning/Testnet/NS-3-Sim/ns-3.45`
- Linux ç³»ç»Ÿ (æ”¯æŒç½‘ç»œå‘½åç©ºé—´)

### å¯åŠ¨æµ‹è¯•ç½‘
```bash
# å¯åŠ¨å®Œæ•´æµ‹è¯•ç½‘
./main.sh

# æŸ¥çœ‹çŠ¶æ€
./main.sh status

# æ¸…ç†ç¯å¢ƒ
./main.sh clean

# æŸ¥çœ‹å¸®åŠ©
./main.sh help
```

### ç«¯å£æ˜ å°„
| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| Geth RPC | 8545 | JSON-RPCæ¥å£ |
| Geth WebSocket | 8546 | WebSocketæ¥å£ |
| Beacon-1 API | 7777 | Beacon Chain API |
| Beacon-2 API | 7778 | Beacon Chain API |
| Beacon-3 API | 7779 | Beacon Chain API |
| Beacon-4 API | 7780 | Beacon Chain API |

## ğŸ“ é¡¹ç›®ç»“æ„

```
eth-pos-devnet/
â”œâ”€â”€ main.sh                          # ä¸»å¯åŠ¨è„šæœ¬
â”œâ”€â”€ docker-compose.yml               # DockeræœåŠ¡é…ç½®
â”œâ”€â”€ README.md                        # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ restart-and-test-network.sh      # ç½‘ç»œæµ‹è¯•è„šæœ¬
â”œâ”€â”€ config/                          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config-1.yml                # Beacon-1é…ç½®
â”‚   â”œâ”€â”€ config-2.yml                # Beacon-2é…ç½®
â”‚   â”œâ”€â”€ config-3.yml                # Beacon-3é…ç½®
â”‚   â””â”€â”€ config-4.yml                # Beacon-4é…ç½®
â”œâ”€â”€ scripts/                         # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ beacon-chain-1-entrypoint.sh # Beacon-1å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ beacon-chain-2-entrypoint.sh # Beacon-2å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ beacon-chain-3-entrypoint.sh # Beacon-3å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ beacon-chain-4-entrypoint.sh # Beacon-4å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ beacon-chain-template.sh     # è„šæœ¬æ¨¡æ¿
â”‚   â”œâ”€â”€ validator-1-entrypoint.sh   # Validator-1å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ validator-2-entrypoint.sh   # Validator-2å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ validator-3-entrypoint.sh   # Validator-3å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ validator-4-entrypoint.sh   # Validator-4å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ geth-entrypoint.sh          # Gethå¯åŠ¨è„šæœ¬
â”œâ”€â”€ ns3/                            # NS-3ç½‘ç»œé…ç½®
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ multi-node-tap-scenario.cc # NS-3åœºæ™¯æ–‡ä»¶
â”œâ”€â”€ logs/                           # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ beacon-1.log               # Beacon-1æ—¥å¿—
â”‚   â”œâ”€â”€ beacon-2.log               # Beacon-2æ—¥å¿—
â”‚   â”œâ”€â”€ beacon-3.log               # Beacon-3æ—¥å¿—
â”‚   â”œâ”€â”€ beacon-4.log               # Beacon-4æ—¥å¿—
â”‚   â””â”€â”€ ns3.log                    # NS-3æ¨¡æ‹Ÿå™¨æ—¥å¿—
â”œâ”€â”€ share/                          # å…±äº«æ–‡ä»¶
â”‚   â”œâ”€â”€ signals/                   # ä¿¡å·æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ bootstrap_enr.txt          # BootstrapèŠ‚ç‚¹ä¿¡æ¯
â”œâ”€â”€ consensus/                      # å…±è¯†å±‚æ•°æ®
â”‚   â”œâ”€â”€ beacondata1/              # Beacon-1æ•°æ®
â”‚   â”œâ”€â”€ beacondata2/              # Beacon-2æ•°æ®
â”‚   â”œâ”€â”€ beacondata3/              # Beacon-3æ•°æ®
â”‚   â”œâ”€â”€ beacondata4/              # Beacon-4æ•°æ®
â”‚   â”œâ”€â”€ validatordata1/           # Validator-1æ•°æ®
â”‚   â”œâ”€â”€ validatordata2/           # Validator-2æ•°æ®
â”‚   â”œâ”€â”€ validatordata3/           # Validator-3æ•°æ®
â”‚   â”œâ”€â”€ validatordata4/           # Validator-4æ•°æ®
â”‚   â””â”€â”€ genesis.ssz               # åˆ›ä¸–çŠ¶æ€æ–‡ä»¶
â””â”€â”€ execution/                     # æ‰§è¡Œå±‚æ•°æ®
    â”œâ”€â”€ geth/                     # Gethæ•°æ®ç›®å½•
    â”œâ”€â”€ genesis.json              # Gethåˆ›ä¸–æ–‡ä»¶
    â””â”€â”€ jwtsecret                 # JWTå¯†é’¥æ–‡ä»¶
```

## ğŸ”§ ä»£ç ä¼˜åŒ–è¯´æ˜

### 1. main.sh ä¼˜åŒ–
- âœ… **æ¨¡å—åŒ–ç»“æ„**: æŒ‰åŠŸèƒ½åˆ†ç»„å‡½æ•°
- âœ… **ä¸¥æ ¼é”™è¯¯å¤„ç†**: ä½¿ç”¨ `set -euo pipefail`
- âœ… **è¯¦ç»†æ³¨é‡Š**: æ¯ä¸ªå‡½æ•°éƒ½æœ‰è¯´æ˜
- âœ… **é…ç½®å¸¸é‡**: ä½¿ç”¨ `readonly` å®šä¹‰å¸¸é‡
- âœ… **å½©è‰²æ—¥å¿—**: ä¸åŒçº§åˆ«çš„æ—¥å¿—ä½¿ç”¨ä¸åŒé¢œè‰²
- âœ… **ä¾èµ–æ£€æŸ¥**: å¯åŠ¨å‰æ£€æŸ¥å¿…è¦å‘½ä»¤å’Œç›®å½•
- âœ… **è¶…æ—¶å¤„ç†**: ä¿¡å·ç­‰å¾…æ·»åŠ è¶…æ—¶æœºåˆ¶

### 2. docker-compose.yml ä¼˜åŒ–
- âœ… **åˆ†ç»„æ³¨é‡Š**: æŒ‰æœåŠ¡ç±»å‹åˆ†ç»„
- âœ… **è¯¦ç»†è¯´æ˜**: æ¯ä¸ªæœåŠ¡éƒ½æœ‰åŠŸèƒ½è¯´æ˜
- âœ… **ç«¯å£æ³¨é‡Š**: ç«¯å£æ˜ å°„æ·»åŠ è¯´æ˜
- âœ… **ä¾èµ–å…³ç³»**: æ¸…æ™°çš„ä¾èµ–å…³ç³»é…ç½®
- âœ… **ç¯å¢ƒå˜é‡**: ç»Ÿä¸€çš„ç¯å¢ƒå˜é‡é…ç½®

### 3. scripts/ ä¼˜åŒ–
- âœ… **ç»Ÿä¸€æ¨¡æ¿**: åˆ›å»ºé€šç”¨è„šæœ¬æ¨¡æ¿
- âœ… **é”™è¯¯å¤„ç†**: æ·»åŠ æ–‡ä»¶æ£€æŸ¥å’Œé”™è¯¯å¤„ç†
- âœ… **è¶…æ—¶æœºåˆ¶**: ä¿¡å·ç­‰å¾…æ·»åŠ è¶…æ—¶
- âœ… **è¯¦ç»†æ—¥å¿—**: æ—¶é—´æˆ³å’Œæ—¥å¿—çº§åˆ«
- âœ… **é…ç½®å¸¸é‡**: ä½¿ç”¨å¸¸é‡å®šä¹‰è·¯å¾„

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

### ç½‘ç»œæµ‹è¯•
```bash
# æµ‹è¯•ç½‘ç»œå»¶è¿Ÿå’Œè¿æ¥
./restart-and-test-network.sh
```

### APIæµ‹è¯•
```bash
# æ£€æŸ¥beacon-chainè¿æ¥çŠ¶æ€
curl http://localhost:7777/eth/v1/node/peers | jq

# æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€
for port in 7777 7778 7779 7780; do
    echo "Port $port:"
    curl -s "http://localhost:$port/eth/v1/node/peers" | jq '.data | length'
done
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **P2Pè¿æ¥å¤±è´¥**
   - æ£€æŸ¥NS-3ç½‘ç»œæ˜¯å¦æ­£å¸¸è¿è¡Œ
   - éªŒè¯ç½‘ç»œå»¶è¿Ÿè®¾ç½® (å½“å‰: 1ms)
   - æŸ¥çœ‹beacon-chainæ—¥å¿—

2. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
   - éªŒè¯ç«¯å£æ˜¯å¦è¢«å ç”¨
   - æŸ¥çœ‹å®¹å™¨æ—¥å¿—

3. **ç½‘ç»œè®¾å¤‡é—®é¢˜**
   - æ¸…ç†ç°æœ‰ç½‘ç»œé…ç½®: `./main.sh clean`
   - æ£€æŸ¥TAPè®¾å¤‡çŠ¶æ€: `ip link show | grep tap-beacon`
   - é‡å¯ç½‘ç»œæœåŠ¡

### æ—¥å¿—ä½ç½®
- **Beacon Chain**: `logs/beacon-*.log`
- **NS-3**: `logs/ns3.log`
- **Docker**: `docker logs <container-name>`

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç½‘ç»œæ€§èƒ½
- **å»¶è¿Ÿ**: ~2ms (å¾€è¿”)
- **å¸¦å®½**: 100Mbps
- **ä¸¢åŒ…ç‡**: <5% (æ­£å¸¸æƒ…å†µ)

### ç³»ç»Ÿèµ„æº
- **å†…å­˜**: ~2GB (æ‰€æœ‰æœåŠ¡)
- **CPU**: ~10% (ç©ºé—²çŠ¶æ€)
- **å­˜å‚¨**: ~1GB (åˆå§‹æ•°æ®)

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚

## ğŸ™ è‡´è°¢

- Prysm Labs - Beacon Chain å®ç°
- Go-Ethereum - æ‰§è¡Œå±‚å®¢æˆ·ç«¯
- NS-3 - ç½‘ç»œæ¨¡æ‹Ÿå™¨
- Docker - å®¹å™¨åŒ–å¹³å°